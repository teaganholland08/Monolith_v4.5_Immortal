version: '3.8'

services:
  # 1. THE BRAIN (Project Monolith)
  monolith:
    build: .
    container_name: monolith_omega
    volumes:
      - .:/app
    environment:
      - USE_SIMULATION_MODE=true
    depends_on:
      - ghostfolio
    restart: always

  # 2. THE BANK (Ghostfolio)
  ghostfolio:
    image: ghostfolio/ghostfolio:latest
    container_name: monolith_finance
    ports:
      - "3333:3333"
    environment:
      - POSTGRES_PASSWORD=monolith_secret
    volumes:
      - ghostfolio_data:/var/lib/postgresql/data

  # 3. THE HANDS (Home Assistant)
  homeassistant:
    image: lscr.io/linuxserver/homeassistant:latest
    container_name: monolith_home
    network_mode: host
    volumes:
      - ha_config:/config
    restart: unless-stopped

volumes:
  ghostfolio_data:
  ha_config:
